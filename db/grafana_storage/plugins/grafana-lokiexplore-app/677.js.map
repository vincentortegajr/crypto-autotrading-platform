{"version":3,"file":"677.js?_cache=212c1ea885ae6d839340","mappings":"wuCAYO,SAASA,EAA8B,G,IAAA,kBAC5CC,EAAiB,MACjBC,EAAK,eACLC,EAAc,eACdC,EAAc,QACdC,GAL4C,EAMzCC,EAAAA,EANyC,GAC5CL,oBACAC,QACAC,iBACAC,iBACAC,YAGA,MAAME,EAAa,IAAIC,EAAAA,GAAeJ,GAOtC,GANAG,EAAWE,iBAAkBH,IACvBL,GACFA,EAAkBK,EAAMI,UAIvBR,EAKH,OAJAS,QAAQC,MAAM,uGAGdC,EAAAA,EAAAA,IAAqBC,EAAAA,GAAkBC,gBAAiBC,EAAAA,GAAoBD,gBAAgBE,gBACrF,MAGTC,EAAAA,EAAAA,WAEA,MAAM,aAAEC,EAAY,YAAEC,IAAgBC,EAAAA,EAAAA,IAAoBnB,GACpDoB,GAAmBD,EAAAA,EAAAA,IAAoBlB,QAAAA,EAAkB,IAEzDoB,EAAyCJ,EAAaK,IAAKC,IAAY,CAC3EC,IAAKD,EAAOC,IACZC,SAAUF,EAAOE,SACjBjB,MAAOe,EAAOf,SAGVkB,EAA2CN,EAAiBH,aAAaK,IAAKC,IAAY,CAC9FC,IAAKD,EAAOC,IACZC,SAAUF,EAAOE,SACjBjB,MAAOe,EAAOf,SAMhB,OAFAG,EAAAA,EAAAA,IAAqBC,EAAAA,GAAkBC,gBAAiBC,EAAAA,GAAoBD,gBAAgBc,eAErF,IAAIC,EAAAA,EAAW,E,kUAAA,IACjBxB,GAAAA,CACHC,aACAwB,mBAAoBX,EACpBY,UAAU,EACVC,gBAAiB5B,EACjBkB,gBACAK,oBAEJ,CAEO,MAAMM,EAAqB,KAEnB,SAASC,EAAwBC,GAC9C,MAAOC,EAAaC,IAAkBC,EAAAA,EAAAA,UAA4B,MASlE,OAPAC,EAAAA,EAAAA,WAAU,KACHH,KACHI,EAAAA,EAAAA,KAA0B,GAC1BH,EAAetC,EAA8BoC,MAE9C,CAACC,EAAaD,IAEZC,EAKH,kBAACK,EAAAA,GAAsBA,CACrBC,MAAON,EACPO,iBAAiB,EACjBC,2BAA2B,EAC3BC,UAA0B,QAAfV,EAAAA,EAAMU,iBAANV,IAAAA,EAAAA,EAAmBF,EAC9Ba,qBAAsB,CAAC,OAAQ,KAAM,WAAYC,EAAAA,EAAsBC,EAAAA,IAEvE,kBAACZ,EAAYa,UAAS,CAACC,MAAOd,KAXzB,K,IAQMD,CAMjB,C","sources":["webpack://grafana-lokiexplore-app/./Components/EmbeddedLogsExploration/EmbeddedLogs.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\n\nimport { AdHocFilterWithLabels, SceneTimeRange, UrlSyncContextProvider } from '@grafana/scenes';\n\nimport { reportAppInteraction, USER_EVENTS_ACTIONS, USER_EVENTS_PAGES } from '../../services/analytics';\nimport { drilldownLabelUrlKey, pageSlugUrlKey } from '../ServiceScene/ServiceSceneConstants';\nimport { EmbeddedLogsExplorationProps } from './types';\nimport { IndexScene } from 'Components/IndexScene/IndexScene';\nimport initRuntimeDs from 'services/datasource';\nimport { getMatcherFromQuery } from 'services/logqlMatchers';\nimport { initializeMetadataService } from 'services/metadata';\n\nexport function buildLogsExplorationFromState({\n  onTimeRangeChange,\n  query,\n  referenceQuery,\n  timeRangeState,\n  options,\n  ...state\n}: EmbeddedLogsExplorationProps) {\n  const $timeRange = new SceneTimeRange(timeRangeState);\n  $timeRange.subscribeToState((state) => {\n    if (onTimeRangeChange) {\n      onTimeRangeChange(state.value);\n    }\n  });\n\n  if (!query) {\n    console.error('No query parameter found! Please pass in a valid logQL query string when embedding Logs Drilldown.');\n\n    // Report invalid init\n    reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.embedded_error);\n    return null;\n  }\n\n  initRuntimeDs();\n\n  const { labelFilters, lineFilters } = getMatcherFromQuery(query);\n  const referenceFilters = getMatcherFromQuery(referenceQuery ?? '');\n\n  const initialLabels: AdHocFilterWithLabels[] = labelFilters.map((filter) => ({\n    key: filter.key,\n    operator: filter.operator,\n    value: filter.value,\n  }));\n\n  const referenceLabels: AdHocFilterWithLabels[] = referenceFilters.labelFilters.map((filter) => ({\n    key: filter.key,\n    operator: filter.operator,\n    value: filter.value,\n  }));\n\n  // Report valid init\n  reportAppInteraction(USER_EVENTS_PAGES.service_details, USER_EVENTS_ACTIONS.service_details.embedded_init);\n\n  return new IndexScene({\n    ...state,\n    $timeRange,\n    defaultLineFilters: lineFilters,\n    embedded: true,\n    embeddedOptions: options,\n    initialLabels,\n    referenceLabels,\n  });\n}\n\nexport const VARIABLE_NAMESPACE = 'ld';\n\nexport default function EmbeddedLogsExploration(props: EmbeddedLogsExplorationProps) {\n  const [exploration, setExploration] = useState<IndexScene | null>(null);\n\n  useEffect(() => {\n    if (!exploration) {\n      initializeMetadataService(true);\n      setExploration(buildLogsExplorationFromState(props));\n    }\n  }, [exploration, props]);\n\n  if (!exploration) {\n    return null;\n  }\n\n  return (\n    <UrlSyncContextProvider\n      scene={exploration}\n      updateUrlOnInit={false}\n      createBrowserHistorySteps={true}\n      namespace={props.namespace ?? VARIABLE_NAMESPACE}\n      excludeFromNamespace={['from', 'to', 'timezone', drilldownLabelUrlKey, pageSlugUrlKey]}\n    >\n      <exploration.Component model={exploration} />\n    </UrlSyncContextProvider>\n  );\n}\n"],"names":["buildLogsExplorationFromState","onTimeRangeChange","query","referenceQuery","timeRangeState","options","state","$timeRange","SceneTimeRange","subscribeToState","value","console","error","reportAppInteraction","USER_EVENTS_PAGES","service_details","USER_EVENTS_ACTIONS","embedded_error","initRuntimeDs","labelFilters","lineFilters","getMatcherFromQuery","referenceFilters","initialLabels","map","filter","key","operator","referenceLabels","embedded_init","IndexScene","defaultLineFilters","embedded","embeddedOptions","VARIABLE_NAMESPACE","EmbeddedLogsExploration","props","exploration","setExploration","useState","useEffect","initializeMetadataService","UrlSyncContextProvider","scene","updateUrlOnInit","createBrowserHistorySteps","namespace","excludeFromNamespace","drilldownLabelUrlKey","pageSlugUrlKey","Component","model"],"sourceRoot":""}